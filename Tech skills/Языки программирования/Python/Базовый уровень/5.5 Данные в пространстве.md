## Сети

Распределенные вычисления и сети решают следующие задачи
- Производительность - быстрые компоненты должны оставаться занятыми и не ждать пока отработают медленные.
- Устойчивость - нужно дублировать задачи чтобы обойти проблемы по отказу аппаратного и ПО.
- Простота - разбитие сложных задач на множество простых, которые легче создавать, понимать и исправлять.
- Масштабируемость - увеличение количества серверов, чтобы справляться с нагрузкой и уменьшение их для экономии денег.

### TCP/IP
Соединения, обмен, обработка данных в интернете основаны на соглашениях. Такие правила называются протоколами и они упорядочены в слои.

Можно делать что угодно в рамках одного слоя, пока мы следуем соглашениям, связанными с работой с более низкими и высокими слоями.

Самый нижний слой управляет такими аспектами, как электрические сигналы. Каждый более высокий слой базируется на нижних. Примерно в середине находится IP (Internet Protocol — интернет-протокол), на котором определяется, как  адресуются локации сети и перемещаются пакеты (фрагменты) данных. На слое, расположенном выше IP, два протокола описывают, как перемещать байты между локациями.

UDP (User Datagram Protocol — протокол датаграмм пользователя). Служит для обмена небольшим объемом данных. Датаграмма — это небольшое сообщение, которое отправляется целиком; оно похоже на открытку.

TCP (Transmission Control Protocol — протокол управления передачей). Используется для более длинных соединений. С его помощью отправляются потоки байтов, он гарантирует, что они придут по порядку и без дупликаций.

Локальная машина всегда будет иметь IP-адрес 127.0.0.1 и имя localhost. Можно встретить название для этого процесса — интерфейс обратной петли. При подключении к Интернету также появится публичный IP. Если используется домашний компьютер, то он будет скрыт за оборудованием, таким как кабельный модем или роутер. Можно запускать интернет-протоколы даже между процессами на одной машине.

Большая часть Интернета, с которой нужно взаимодействовать, — Всемирная паутина, серверы баз данных и т.д. основана на протоколе TCP, функционирующем поверх протокола IP, сокращенно — TCP/IP.

### Паттерны для работы с сетями
Сетевые приложения можно создать на основе некоторых простых паттернов.

Самым распространенным является «Запрос — ответ», также известный как «Клиент — сервер». Работает синхронно: клиент ожидает ответа сервера. Браузер — это также клиент, делающий HTTP-запрос веб-серверу, который возвращает ответ. Пример - запрос данных о DNS, сети или электронной почте у серверов. Они возвращают ответ или сообщают о проблеме. Для работы можно использовать библиотеку ZeroMQ, называемую сокетами на стероидах.

Еще один распространенный паттерн — «Разветвление на выходе»: вы отправляете данные любому доступному работнику из пула процессов. Примером служит веб-сервер, расположенный за балансировщиком нагрузки.

Противоположностью этого паттерна является «Разветвление на входе»: вы  принимаете данные из одного или нескольких источников. В качестве примера можно привести регистратор, который принимает текстовые сообщения от нескольких процессов и записывает их в единый файл журнала.

Еще один паттерн похож на радио- или телепередачи, он называется «Публикация — подписка» или pub — sub. В рамках этого паттерна публикатор рассылает данные. В простой системе их получат все подписчики. Однако зачастую они могут указать, что заинтересованы только в определенных типах данных (подобные типы часто называются темами), и публикатор будет отправлять лишь эту информацию. Поэтому, в отличие от паттерна «Разветвление на входе», заданный фрагмент данных может получить более чем один подписчик. Если на тему никто не подписался, то данные будут проигнорированы.


Сериализация - преобразование между данными в памяти и последовательностями байтом, в частности, перед их отправкой другому клиенту.

JSON - популярный формат сериализации в RESTful-системах, но с его помощью нельзя выразить все типы данныех Питона.

Pickle - модуль для сохранения и восстановления любого объекта в специальном бинарном формате.

Удаленные вызовы процедур (Remote Procedure Call, RPC) выглядят как обычные функции, но выполняются на удаленных машинах по всей сети. Вместо того чтобы вызывать RESTful API и передавать туда аргументы, закодированные в URL или теле запросов, вы можете вызвать функцию RPC на собственной машине. При этом в RPC-клиенте произойдет следующее.
- преобразует аргументы функции в байты
- отправляет закодированные байты удаленной машине.

На удаленной машине
- полумает закодированные байты запроса
- после получения байто RPC-клиент декодирует их в оригинальные структуры данных
- затем клиент находит и вызывает локальную функцию с помощью раскодированных данных
- далее он кодирует результат работы функции
- отправляет закодированные байты вызывающей стороне.

Затем машина, запустившая процесс, декодирует полученные байты в возвращенные значения.
RPC — это популярный прием, и люди реализовали его множеством способов. На стороне сервера вы запускаете серверную программу, создаете механизм для ее связывания с помощью какого-либо способа транспортировки байтов и метода кодирования/декодирования, определяете функции сервиса и подаете сигнал «RPC готов к работе». Клиенты соединяются с сервером и вызывают одну из его функций с помощью RPC.

Есть XML RPC, JSON RPC, MessagePack RPC, Zerorpc, gRPC, Twirp. 

Инструменты удаленного управления - Salt, Puppet, Chef, Ansible.

394
